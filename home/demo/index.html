<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Naptio — Demo (Screenshots)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    :root{
      color-scheme: dark;
      --basePad: 16px;
      --safeL: env(safe-area-inset-left, 0px);
      --safeR: env(safe-area-inset-right, 0px);
      --padStart: max(var(--basePad), var(--safeL));
      --padEnd:   max(var(--basePad), var(--safeR));
      --headH: 56px;
    }
    html, body{ height:100%; margin:0; background:#000; color:#fff;
      font-family:-apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }

    /* ===== Header: logo + right-aligned video pill on phones ===== */
    header{
      display:grid; grid-template-columns:1fr auto 1fr; align-items:center;
      padding:14px 20px; gap:12px;
      padding-left:max(20px, env(safe-area-inset-left));
      padding-right:max(20px, env(safe-area-inset-right));
      padding-top:max(14px, env(safe-area-inset-top));
      z-index:3;
    }
    .nav-left{ justify-self:start; display:flex; align-items:center; gap:18px; }
    .nav-center{ justify-self:center; }
    .nav-right{ justify-self:end; display:flex; align-items:center; gap:12px; }
    .home-link{ display:inline-flex; align-items:center; line-height:1; color:#fff; text-decoration:none; }
    .icon{ width:26px; height:26px; display:block; }

    .btn-watch{
      border:1px solid rgba(255,255,255,.7);
      background: transparent;
      color:#fff; border-radius:9999px;
      padding:8px 12px; font-weight:700; font-size:0.95rem; line-height:1; cursor:pointer;
    }
    .btn-watch:active{ transform:translateY(1px); }
    @media (min-width:700px){
      /* On desktop keep it tidy; you can hide it if you prefer */
      .btn-watch{ font-size:0.9rem; padding:8px 12px; opacity:.95; }
    }

    /* ---------- MOBILE VIEW (stage) ---------- */
    @media (max-width:699.98px){ main{ display:none !important; } }
    @media (min-width:700px){ .stage{ display:none !important; } }

    .stage{
      position:fixed; left:0; right:0; top:var(--headH); bottom:0;
      background:#000; overflow:hidden; isolation:isolate; z-index:1;
      touch-action: pan-y pinch-zoom;
    }
    .stage.is-fullscreen{ top:0; bottom:0; left:0; right:0; width:100svw; height:100svh; z-index:9999; }
    .track{ display:flex; height:100%; will-change:transform; transition:transform 320ms ease; }
    @media (prefers-reduced-motion:reduce){ .track{ transition:none; } }
    .slide{ flex:0 0 100%; height:100%; display:grid; place-items:center;
      padding:0 max(env(safe-area-inset-right),0px) max(env(safe-area-inset-bottom),0px) max(env(safe-area-inset-left),0px); background:#000; }
    .stage .slide>img{
      max-width:100% !important; max-height:100% !important; width:auto !important; height:auto !important;
      object-fit:contain; object-position:center; display:block; user-select:none; -webkit-user-drag:none; -webkit-touch-callout:none; cursor:zoom-in;
    }
    .dots{ position:absolute; left:0; right:0; bottom:calc(max(10px,2vh) + env(safe-area-inset-bottom));
      display:flex; justify-content:center; gap:8px; pointer-events:auto; z-index:5; }
    .dot{ width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,.35); border:1px solid rgba(255,255,255,.25); cursor:pointer; }
    .dot.active{ background:#fff; }

    /* ---------- DESKTOP VIEW (cards deck) ---------- */
    main{ min-height:100dvh; display:grid; place-items:start center; padding:0 0 24px; }
    .shots{ width:100%; display:grid; justify-items:center; }
    .shots-wrap{ width:100%; max-width:1100px; margin-inline:auto; }
    .shots-track{
      position:relative; display:flex; overflow-x:auto; overscroll-behavior-x:contain;
      scroll-snap-type:x mandatory; scroll-behavior:smooth; gap:0; padding:0 0 10px;
      -webkit-overflow-scrolling:touch; cursor:grab;
      scroll-padding-inline:var(--padStart) var(--padEnd); scrollbar-width:thin; scrollbar-color:#555 transparent;
    }
    .shots-track::-webkit-scrollbar{ height:6px; }
    .shots-track::-webkit-scrollbar-track{ background:transparent; }
    .shots-track::-webkit-scrollbar-thumb{ background:#555; border-radius:9999px; }
    .shots-track.dragging{ scroll-snap-type:none; cursor:grabbing; }
    .shots-track.no-smooth{ scroll-behavior:auto; }
    .shots-track.no-snap{ scroll-snap-type:none; }
    .slide{ flex:0 0 100%; display:grid; place-items:center; scroll-snap-align:center; padding:8px 0; }
    @media (min-width:700px){ .shots-track{ gap:6px; } .slide{ flex:0 0 auto; padding:0; } }
    .device-card{ display:grid; justify-items:center; gap:10px; background:#0c0c0c; border:1px solid #1b1b1b;
      border-radius:16px; padding:14px; box-shadow:0 8px 24px rgba(0,0,0,.35); }
    .device-card img{ width:clamp(280px,96svw,600px); height:auto; display:block; border-radius:10px; -webkit-user-drag:none; user-select:none; pointer-events:auto; }
    @media (min-width:700px){ .device-card img{ width:clamp(168px,21.6vw,270px); } }
    .caption{ font-size:.9rem; color:#d7d7d7; opacity:.9; }
    .shots-dots{ margin-top:10px; display:flex; gap:8px; justify-content:center; align-items:center; padding-inline:var(--padStart) var(--padEnd); }
    .shots-dots [role="tab"]{ width:9px; height:9px; border-radius:50%; background:#3a3a3a; border:0; padding:0; cursor:pointer; transition:transform .12s; }
    .shots-dots [role="tab"][aria-selected="true"]{ background:#fff; transform:scale(1.15); }
    .shots-scrubber{ display:none; margin-top:8px; justify-content:center; }
    @media (min-width:700px){
      .shots-scrubber{ display:flex; }
      .shots-scrubber input[type="range"]{ width:600px; max-width:100%; -webkit-appearance:none; appearance:none; background:transparent; height:16px; }
      .shots-scrubber input[type="range"]::-webkit-slider-runnable-track{ height:4px; background:#3a3a3a; border-radius:9999px; }
      .shots-scrubber input[type="range"]::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:12px; height:12px; border-radius:50%; background:#fff; margin-top:-4px; }
      .shots-scrubber input[type="range"]::-moz-range-track{ height:4px; background:#3a3a3a; border-radius:9999px; }
      .shots-scrubber input[type="range"]::-moz-range-thumb{ width:12px; height:12px; border-radius:50%; background:#fff; border:none; }
    }

    /* ---------- Video section (below images) ---------- */
    .video-section{
      width:100%; display:grid; place-items:center;
      padding:24px 20px 48px;
    }
    .video-wrap{ width:100%; max-width:1100px; margin-inline:auto; }
    .video-aspect{
      position:relative; width:100%;
      padding-top:56.25%; /* 16:9 */
      background:#000; border:1px solid #1b1b1b; border-radius:12px; overflow:hidden;
    }
    .video-aspect iframe{
      position:absolute; inset:0; width:100%; height:100%; border:0; display:block;
    }

    /* ---------- Video overlay (fullscreen + fallback) ---------- */
    .video-overlay{
      position:fixed; inset:0; background:#000; display:none;
      align-items:center; justify-content:center; z-index:2000;
    }
    .video-overlay.visible{ display:flex; }
    .video-frame{
      position:relative; width:100svw; height:100svh;
      padding:0; margin:0; overflow:hidden;
    }
    .video-frame iframe{
      position:absolute; inset:0; width:100%; height:100%; border:0; display:block;
      background:#000;
    }
    .video-close{
      position:fixed;
      top:max(10px, env(safe-area-inset-top)); right:max(10px, env(safe-area-inset-right));
      border:1px solid #2a2a2a; background:rgba(0,0,0,.65); color:#fff;
      border-radius:9999px; padding:8px 12px; cursor:pointer; font-size:18px; z-index:2100;
    }

    /* Fullscreen controls for the mobile image stage */
    .fs-close{
      position: absolute;
      top: calc(env(safe-area-inset-top) + 10px);
      right: calc(env(safe-area-inset-right) + 10px);
      width: 44px; height: 44px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(0,0,0,.65);
      color: #fff; font-size: 24px; line-height: 1;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; z-index: 6;
    }
    .fs-bar{
      position: absolute; left: 50%; transform: translateX(-50%);
      bottom: calc(env(safe-area-inset-bottom) + 16px);
      padding: 10px 16px; border-radius: 9999px;
      border: 1px solid rgba(255,255,255,.25);
      background: rgba(0,0,0,.55); color: #fff; font-weight: 600;
      cursor: pointer; z-index: 6;
    }

    /* Hide close buttons unless overlay/modal is visible */
    .img-modal .img-close,
    .video-overlay .video-close,
    .stage .fs-close,
    .stage .fs-bar {
      display: none !important;
    }
    
    .img-modal.visible .img-close,
    .video-overlay.visible .video-close,
    .stage.is-fullscreen .fs-close,
    .stage.is-fullscreen .fs-bar {
      display: inline-flex !important;  /* for pills/buttons */
    }

    .no-scroll{ overflow:hidden; }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <nav class="nav-left" aria-label="Primary">
      <a href="https://hungryfaceai.github.io/hungryface/home" class="home-link" aria-label="Home" title="Home">
        <svg class="icon" aria-hidden="true" focusable="false">
          <use href="/hungryface/assets/icons.svg#icon-cradle-ai" xlink:href="/hungryface/assets/icons.svg#icon-cradle-ai"></use>
        </svg>
      </a>
    </nav>
    <div class="nav-center" aria-hidden="true"></div>
    <div class="nav-right">
      <button id="watchCta" class="btn-watch" type="button" aria-label="Watch demo video">▶ Watch demo</button>
    </div>
  </header>

  <!-- MOBILE STAGE -->
  <section class="stage" role="region" aria-label="Naptio demo screenshots" id="stage">
    <button class="fs-close" id="fsClose" aria-label="Close fullscreen" title="Close">×</button>
    <button class="fs-bar" id="fsBar" aria-label="Close fullscreen">Close</button>
    <div class="track" id="track" aria-live="polite"></div>
    <div class="dots" id="dots" role="tablist" aria-label="Slides"></div>
  </section>

  <!-- DESKTOP DECK -->
  <main>
    <section class="shots" aria-label="App screenshots (desktop)">
      <div class="shots-wrap">
        <div id="shotsTrack" class="shots-track" tabindex="0" role="region" aria-roledescription="carousel" aria-label="Feature screenshots" aria-live="polite">
          <div class="slide" role="group" aria-label="Camera (sender)">
            <figure class="device-card">
              <img src="/hungryface/home/snapshots/sender2.jpg" alt="Camera sender screen" loading="lazy">
              <figcaption class="caption">Camera (sender)</figcaption>
            </figure>
          </div>
          <div class="slide" role="group" aria-label="Prone detection">
            <figure class="device-card">
              <img src="/hungryface/home/snapshots/prone2.jpg" alt="Prone detection screen" loading="lazy">
              <figcaption class="caption">Prone detection</figcaption>
            </figure>
          </div>
          <div class="slide" role="group" aria-label="Motion detection">
            <figure class="device-card">
              <img src="/hungryface/home/snapshots/motion2.jpg" alt="Motion detection screen" loading="lazy">
              <figcaption class="caption">Motion detection</figcaption>
            </figure>
          </div>
          <div class="slide" role="group" aria-label="Audio alerts">
            <figure class="device-card">
              <img src="/hungryface/home/snapshots/audio.jpg" alt="Audio alerts screen" loading="lazy">
              <figcaption class="caption">Audio alerts</figcaption>
            </figure>
          </div>
          <div class="slide" role="group" aria-label="Audio training">
            <figure class="device-card">
              <img src="/hungryface/home/snapshots/training.jpg" alt="Audio training screen" loading="lazy">
              <figcaption class="caption">Audio training</figcaption>
            </figure>
          </div>
          <div class="slide" role="group" aria-label="Live dashboard">
            <figure class="device-card">
              <img src="/hungryface/home/snapshots/dashboard.jpg" alt="Live dashboard screen" loading="lazy">
              <figcaption class="caption">Live dashboard</figcaption>
            </figure>
          </div>
        </div>
        <div id="shotsDots" class="shots-dots" role="tablist" aria-label="Choose screenshot"></div>
        <div class="shots-scrubber">
          <input id="shotsScrubber" type="range" min="0" step="1" value="0" aria-label="Jump between screenshots">
        </div>
      </div>
    </section>
  </main>

  <!-- VIDEO (below images) -->
  <section class="video-section" id="demo-video" aria-label="Demo video">
    <div class="video-wrap">
      <div class="video-aspect">
        <iframe
          src="https://www.youtube-nocookie.com/embed/HvIA_OH9to8?rel=0&modestbranding=1&playsinline=1"
          title="Naptio — demo video"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen
          loading="lazy"
          referrerpolicy="strict-origin-when-cross-origin">
        </iframe>
      </div>
    </div>
  </section>

  <!-- Desktop image fullscreen modal -->
  <div id="img-modal" class="img-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Screenshot preview">
    <button class="img-close" type="button" aria-label="Close">✕</button>
    <div class="img-wrap"><img id="img-modal-img" alt=""></div>
  </div>

  <!-- Video overlay (fullscreen + fallback) -->
  <div id="videoOverlay" class="video-overlay" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Demo video">
    <button class="video-close" id="videoClose" type="button" aria-label="Close video">✕</button>
    <div class="video-frame">
      <iframe
        id="videoFrame"
        src=""
        title="Naptio — demo video"
        allow="autoplay; encrypted-media; picture-in-picture; accelerometer; gyroscope; web-share"
        allowfullscreen
        referrerpolicy="strict-origin-when-cross-origin">
      </iframe>
    </div>
  </div>

  <script>
  (function(){
    /* ---------- MOBILE slider (build once) ---------- */
    function initMobile(){
      const BASE = '/hungryface/home/snapshots/';
      const IMAGES = ['sender2.jpg','prone2.jpg','motion2.jpg','audio.jpg','training.jpg','dashboard.jpg'];

      const stage  = document.getElementById('stage');
      const track  = document.getElementById('track');
      const dotsEl = document.getElementById('dots');
      const header = document.querySelector('header');

      if (track.dataset.built === '1') return;
      track.dataset.built = '1';
      track.textContent = ''; dotsEl.textContent = '';

      let index = 0, width = 0;
      let dragging = false, startX = 0, startY = 0, currentX = 0, currentY = 0, deltaX = 0, deltaY = 0, startTransform = 0;

      const setVar = (name, px)=> document.documentElement.style.setProperty(name, `${Math.max(0, px|0)}px`);
      function measure(){
        setVar('--headH', stage.classList.contains('is-fullscreen') ? 0 : (header?.offsetHeight ?? 0));
        width = stage.clientWidth; translateTo(index, false);
      }

      IMAGES.forEach((name, i) => {
        const slide = document.createElement('section');
        slide.className = 'slide'; slide.setAttribute('role', 'tabpanel');
        slide.setAttribute('aria-label', `Slide ${i+1} of ${IMAGES.length}`);

        const img = document.createElement('img');
        img.src = BASE + name; img.alt = `App screenshot ${i+1}`;
        img.decoding = 'async'; img.loading = i === 0 ? 'eager' : 'lazy';
        slide.appendChild(img); track.appendChild(slide);

        const dot = document.createElement('button');
        dot.className = 'dot' + (i === 0 ? ' active' : '');
        dot.setAttribute('role', 'tab'); dot.setAttribute('aria-label', `Go to slide ${i+1}`);
        dot.addEventListener('click', () => goTo(i));
        dotsEl.appendChild(dot);

        img.addEventListener('click', maybeEnterFullscreen, { passive: true });
      });

      const updateDots = ()=> [...dotsEl.children].forEach((d, i) => d.classList.toggle('active', i === index));
      function translateTo(i, withAnim = true){
        index = Math.max(0, Math.min(IMAGES.length - 1, i));
        const noMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        track.style.transition = withAnim && !noMotion ? 'transform 320ms ease' : 'none';
        track.style.transform  = `translateX(${-index * width}px)`;
        preload(index - 1); preload(index + 1); updateDots();
      }
      function preload(i){
        if (i < 0 || i >= IMAGES.length) return;
        const img = track.children[i]?.querySelector('img');
        if (img && img.loading === 'lazy') img.loading = 'eager';
      }
      const goTo = (i)=> translateTo(i, true);
      const next = ()=> translateTo(index + 1, true);
      const prev = ()=> translateTo(index - 1, true);

      const startDrag = (x, y) => { dragging = true; startX = x; startY = y; currentX = x; currentY = y; deltaX = 0; deltaY = 0;
        startTransform = -index * width; track.style.transition = 'none'; };
      const moveDrag  = (x, y) => {
        if (!dragging) return;
        currentX = x; currentY = y; deltaX = currentX - startX; deltaY = currentY - startY;
        if (stage.classList.contains('is-fullscreen')) {
          const mostlyVertical = Math.abs(deltaY) > Math.abs(deltaX) * 1.35;
          if (mostlyVertical && deltaY > 90) { exitFullscreen(); dragging = false; return; }
        }
        const resistance = (index === 0 && deltaX > 0) || (index === IMAGES.length - 1 && deltaX < 0) ? 0.35 : 1;
        track.style.transform = `translateX(${startTransform + deltaX * resistance}px)`;
      };
      const endDrag   = () => {
        if (!dragging) return; dragging = false;
        const threshold = Math.min(140, width * 0.12);
        if (deltaX <= -threshold) next();
        else if (deltaX >= threshold) prev();
        else translateTo(index, true);
      };

      stage.addEventListener('touchstart', (e) => startDrag(e.touches[0].clientX, e.touches[0].clientY), { passive: true });
      stage.addEventListener('touchmove',  (e) => moveDrag(e.touches[0].clientX,  e.touches[0].clientY),  { passive: true });
      stage.addEventListener('touchend', endDrag);
      stage.addEventListener('pointerdown', (e) => { if (e.pointerType !== 'mouse') startDrag(e.clientX, e.clientY); });
      stage.addEventListener('pointermove', (e) => moveDrag(e.clientX, e.clientY));
      stage.addEventListener('pointerup', endDrag);
      stage.addEventListener('pointercancel', endDrag);

      window.addEventListener('keydown', (e) => { if (e.key === 'Escape') exitFullscreen(); });

      const isMobileLike = () => window.matchMedia('(pointer: coarse), (max-width: 780px)').matches;
      async function maybeEnterFullscreen() {
        if (!isMobileLike()) return;
        try { if (stage.requestFullscreen) { await stage.requestFullscreen(); } } catch {}
        stage.classList.add('is-fullscreen'); measure();
      }
      function exitFullscreen() {
        if (document.fullscreenElement) { document.exitFullscreen().catch(()=>{}); }
        stage.classList.remove('is-fullscreen'); measure();
      }

      const fsClose = document.getElementById('fsClose');
      const fsBar   = document.getElementById('fsBar');
      fsClose?.addEventListener('click', exitFullscreen);
      fsBar  ?.addEventListener('click', exitFullscreen);
      stage.addEventListener('click', (e) => {
        if (!stage.classList.contains('is-fullscreen')) return;
        if (e.target.closest('.slide > img, .dot, #fsClose, #fsBar')) return;
        exitFullscreen();
      });

      window.addEventListener('load', measure);
      window.addEventListener('resize', measure);
      window.addEventListener('orientationchange', measure);
      new ResizeObserver(measure).observe(header);
    }

    /* ---------- DESKTOP deck + image modal ---------- */
    function initDesktop(){
      const track = document.getElementById('shotsTrack');
      const dotsWrap = document.getElementById('shotsDots');
      const scrub = document.getElementById('shotsScrubber');

      const imgModal = document.getElementById('img-modal');
      const modalImg = document.getElementById('img-modal-img');
      const btnClose = imgModal.querySelector('.img-close');
      const requestFS = async (el)=>{ try{
        if (document.fullscreenElement) return true;
        if (el.requestFullscreen){ await el.requestFullscreen(); return true; }
        if (el.webkitRequestFullscreen){ el.webkitRequestFullscreen(); return true; }
      }catch{} return false; };
      const exitFS = async ()=>{ try{
        if (document.fullscreenElement && document.exitFullscreen) await document.exitFullscreen();
        if (document.webkitFullscreenElement && document.webkitExitFullscreen) document.webkitExitFullscreen();
      }catch{} };
      const openModalSrc = (src,alt)=>{ modalImg.src=src; modalImg.alt=alt||''; imgModal.classList.add('visible'); imgModal.setAttribute('aria-hidden','false');
        document.documentElement.classList.add('no-scroll'); requestFS(imgModal).then(ok=>{ if(!ok) imgModal.classList.add('fullscreen'); }); };
      const closeModal = async()=>{ imgModal.classList.remove('visible','fullscreen'); imgModal.setAttribute('aria-hidden','true');
        document.documentElement.classList.remove('no-scroll'); await exitFS(); setTimeout(()=>{ modalImg.src=''; },50); };
      imgModal.addEventListener('click', e=>{ if(e.target===imgModal) closeModal(); });
      btnClose.addEventListener('click', closeModal);
      document.addEventListener('keydown', e=>{ if(e.key==='Escape' && imgModal.classList.contains('visible')) closeModal(); });

      if (!track || !dotsWrap) return;

      let originals = Array.from(track.querySelectorAll('.slide'));
      originals.forEach((s,i)=>{ s.dataset.index=String(i); });
      const TOTAL = originals.length;

      const mkClone = (el)=>{ const c = el.cloneNode(true); c.dataset.clone='1'; c.dataset.index=el.dataset.index; return c; };
      track.insertBefore(mkClone(originals[TOTAL-1]), track.firstChild);
      track.appendChild(mkClone(originals[0]));
      let slides = Array.from(track.querySelectorAll('.slide'));

      for (let i=0;i<TOTAL;i++){
        const b=document.createElement('button');
        b.type='button'; b.setAttribute('role','tab'); b.setAttribute('aria-selected', i===0?'true':'false');
        b.title=`Go to slide ${i+1}`; b.addEventListener('click', ()=> goTo(i));
        dotsWrap.appendChild(b);
      }
      const dots = Array.from(dotsWrap.querySelectorAll('[role="tab"]'));
      let active = 0;

      function setActive(idx){ active=idx; dots.forEach((d,i)=>d.setAttribute('aria-selected', i===idx?'true':'false')); if(scrub) scrub.value=String(idx); }
      function getOriginalByIndex(i){ return originals[i]; }
      function normalizedIndex(slideEl){ return Number(slideEl.dataset.index)%TOTAL; }
      function centerOn(el, behavior='smooth'){ const left = Math.round(el.offsetLeft + el.offsetWidth/2 - track.clientWidth/2); track.scrollTo({ left, behavior }); }
      function goTo(realIndex, opts={}){ const n=((realIndex%TOTAL)+TOTAL)%TOTAL; const target=getOriginalByIndex(n); if(!target) return; centerOn(target, opts.behavior||'smooth'); setActive(n); }
      function jumpToOriginal(real){ const dest=getOriginalByIndex(real); if(!dest) return; track.classList.add('no-snap','no-smooth'); centerOn(dest,'auto');
        requestAnimationFrame(()=>{ track.classList.remove('no-snap'); requestAnimationFrame(()=> track.classList.remove('no-smooth')); }); setActive(real); }
      function indexFromCenter(){ const rect=track.getBoundingClientRect(); const cx=rect.left+rect.width/2; let best=0,dist=Infinity;
        slides.forEach((s,i)=>{ const r=s.getBoundingClientRect(); const mid=r.left+r.width/2; const d=Math.abs(mid-cx); if(d<dist){dist=d;best=i;} }); return best; }

      if (scrub){
        scrub.min='0'; scrub.max=String(TOTAL-1); scrub.step='1'; scrub.value='0';
        const fitScrubber=()=>{ const img=track.querySelector('.slide:not([data-clone]) img'); if(!img) return;
          const w=Math.round(img.getBoundingClientRect().width); scrub.style.width = w ? (w+'px') : ''; };
        window.addEventListener('resize', fitScrubber, { passive:true });
        new ResizeObserver(fitScrubber).observe(track); fitScrubber();
        const onScrub=v=>goTo(parseInt(v,10)||0, {behavior:'auto'}); scrub.addEventListener('input', e=>onScrub(e.currentTarget.value)); scrub.addEventListener('change', e=>onScrub(e.currentTarget.value));
      }

      let raf=null;
      track.addEventListener('scroll', ()=>{
        if(raf) return;
        raf=requestAnimationFrame(()=>{
          const idxAll=indexFromCenter(); const el=slides[idxAll]; if(!el){ raf=null; return; }
          const real=normalizedIndex(el); setActive(real);
          if (el.dataset.clone==='1'){
            const firstCentered = (idxAll===0) && (real===TOTAL-1);
            const lastCentered  = (idxAll===slides.length-1) && (real===0);
            if (firstCentered || lastCentered) jumpToOriginal(real);
          }
          raf=null;
        });
      });

      let dragging=false,startX=0,startScroll=0,pointerId=null,dragStart=0;
      const SWIPE_PX=50, FLICK_MS=220, FLICK_PX=12;
      track.addEventListener('pointerdown', e=>{ if(e.pointerType!=='mouse'||e.button!==0) return;
        pointerId=e.pointerId; track.setPointerCapture(pointerId);
        dragging=true; startX=e.clientX; startScroll=track.scrollLeft; dragStart=performance.now();
        track.classList.add('dragging');
      });
      track.addEventListener('pointermove', e=>{ if(!dragging) return; e.preventDefault(); const dx=e.clientX-startX; track.scrollLeft=startScroll-dx; });
      function endDrag(){
        if(!dragging) return; dragging=false; track.classList.remove('dragging'); if(pointerId) track.releasePointerCapture(pointerId); pointerId=null;
        const elapsed=performance.now()-dragStart; const movedPX=startScroll-track.scrollLeft;
        const isFlick=elapsed<FLICK_MS && Math.abs(movedPX)>FLICK_PX; const passed=Math.abs(movedPX)>SWIPE_PX;
        if(isFlick||passed){ const dir=movedPX<0?1:-1; goTo((active+dir+TOTAL)%TOTAL, {behavior:'smooth'}); return; }
        const idxInAll=indexFromCenter(); const real=normalizedIndex(slides[idxInAll]); goTo(real,{behavior:'smooth'});
      }
      track.addEventListener('pointerup', endDrag);
      track.addEventListener('pointercancel', endDrag);
      track.addEventListener('pointerleave', endDrag);

      track.addEventListener('click', e=>{
        const img = e.target && e.target.tagName==='IMG' ? e.target : null; if(!img) return;
        openModalSrc(img.currentSrc || img.src, img.alt || '');
      });

      function imagesReady(){
        const imgs = Array.from(track.querySelectorAll('img'));
        return Promise.all(imgs.map(img => (img.complete && img.naturalWidth) ? Promise.resolve() : new Promise(res => img.addEventListener('load', res, { once:true }))));
      }
      (async function(){
        track.classList.add('no-snap','no-smooth'); goTo(0,{behavior:'auto'});
        requestAnimationFrame(()=>{ track.classList.remove('no-snap'); requestAnimationFrame(()=> track.classList.remove('no-smooth')); });
        await imagesReady(); requestAnimationFrame(()=> requestAnimationFrame(()=> { jumpToOriginal(0); }));
      })();
    }

    // ---------- Video CTA → fullscreen overlay (autoplay muted) ----------
    (function installVideoOverlay(){
      const watchBtn = document.getElementById('watchCta');
      const overlay  = document.getElementById('videoOverlay');
      const iframe   = document.getElementById('videoFrame');
      const closeBtn = document.getElementById('videoClose');

      const YT_URL = 'https://www.youtube-nocookie.com/embed/HvIA_OH9to8'
        + '?autoplay=1&mute=1&playsinline=1&modestbranding=1&rel=0';

      async function openVideo(){
        // Set src on click to maximize autoplay success
        iframe.src = YT_URL;
        overlay.classList.add('visible');
        overlay.setAttribute('aria-hidden','false');
        document.documentElement.classList.add('no-scroll');

        // Try fullscreen; if it fails, overlay still fills the viewport
        try{
          if (document.fullscreenElement) return;
          if (overlay.requestFullscreen){ await overlay.requestFullscreen(); }
          else if (overlay.webkitRequestFullscreen){ overlay.webkitRequestFullscreen(); }
        }catch{}
      }

      async function closeVideo(){
        overlay.classList.remove('visible');
        overlay.setAttribute('aria-hidden','true');
        document.documentElement.classList.remove('no-scroll');

        // Stop playback by resetting src
        try{ iframe.src = 'about:blank'; }catch{}
        // Exit native fullscreen if any
        try{
          if (document.fullscreenElement && document.exitFullscreen) await document.exitFullscreen();
          if (document.webkitFullscreenElement && document.webkitExitFullscreen) document.webkitExitFullscreen();
        }catch{}
      }

      watchBtn.addEventListener('click', openVideo);
      closeBtn.addEventListener('click', closeVideo);
      overlay.addEventListener('click', (e)=>{ if(e.target === overlay) closeVideo(); });
      document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && overlay.classList.contains('visible')) closeVideo(); });
    })();

    // Boot per layout
    function boot(){
      if (window.matchMedia('(max-width:699.98px)').matches) initMobile();
      else initDesktop();
    }
    boot();

    // Re-init on breakpoint change
    window.matchMedia('(min-width:700px)').addEventListener('change', () => location.reload());
  })();
  </script>
</body>
</html>
